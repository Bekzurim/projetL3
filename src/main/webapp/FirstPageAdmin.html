<!DOCTYPE html>
<html>
	<head>
		<title>Admin</title>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<!-- On charge la bibliothèque JQuery -->
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
		<!-- On charge le moteur de template mustache https://mustache.github.io/ -->
		<script src="https://cdnjs.cloudflare.com/ajax/libs/mustache.js/0.8.1/mustache.min.js"></script>
                                            <!-- On charge l'API Google -->
                                            <script type="text/javascript" src="https://www.google.com/jsapi"></script>
		<script>
			$(document).ready(// Exécuté à la fin du chargement de la page
                                                                 
				function () {
					// On remplit le <select> avec les états existants
					fillCDateDSelector();
                                                                                                              $("#dateD").change(fillCDateFSelector);
					// Quand on sélectionnne un nouvel état, on affiche les clients de cet état
					
				}
			);
			
			 function fillCDateDSelector() {
				// On fait un appel AJAX pour chercher les états existants
				$.ajax({
					url: "ListDateServlet",
					dataType: "json",
					error: showError,
					success: // La fonction qui traite les résultats
						function(result) {
		                                        // Le code source du template est dans la page
							var template = $('#dateDTemplate').html();
							// On combine le template avec le résultat de la requête
							var processedTemplate = Mustache.to_html(template, result);
							// On affiche la liste des options dans le select
							$('#dateD').html(processedTemplate);	
							// On initialise l'affichage des clients
							fillCDateFSelector();		
						}
				});								
			}
                                                                 
                                                                 function fillCDateFSelector() {
                                                                                        var selectedDate = $("#dateD").val();
				// On fait un appel AJAX pour chercher les états existants
				$.ajax({
					url: "ListDateSupeServelet",
					dataType: "json",
                                                                                                             data: { "dateD" : selectedDate },
					error: showError,
					success: // La fonction qui traite les résultats
						function(result) {
		                                        // Le code source du template est dans la page
							var template = $('#dateFTemplate').html();
							// On combine le template avec le résultat de la requête
							var processedTemplate = Mustache.to_html(template, { dateD: selectedDate, records: result.records });
							// On affiche la liste des options dans le select
							$('#dateF').html(processedTemplate);		
						}
				});								
			}
		
			// Afficher les clients dans l'état sélectionné
			function showAffClie() {
				// Quel est l'état sélectionné ?
				var selectedCategorie = $("#categorie").val();	
				// On fait un appel AJAX pour chercher les clients de cet état
				$.ajax({
					url: "ListeProduitCategorieServlet",
					data: { "categorie" : selectedCategorie },
					dataType: "json",
					success: // La fonction qui traite les résultats
						function(result) {
							// Le code source du template est dans la page
							var template = $('#productTemplate').html();
							// On combine le template avec le résultat de la requête
							var processedTemplate = Mustache.to_html(template, { categorie: selectedCategorie, records: result.records });
							// On affiche le résultat dans la page
							$('#product').html(processedTemplate);	
						},
					error: showError
				});				
			}

		// Fonction qui traite les erreurs de la requête
		function showError(xhr, status, message) {
			alert("Erreur: " + status + " : " + message);
		}
        </script>
        <link rel="stylesheet" type="text/css" href="css/style.css">
    </head>
    <body>
        <div>
           <a id="connexion" href="logout">Deconnection</a>
            <br>
            <h1> Affichage des produit disponible : </h1>
            <h2>Veuillez selectionner par categorie.</h2>
        </div>
        
   
            <div id="erreur"></div>
            <form>
                <label for="dateD">Choix de la date de début : </label>
                <select id="dateD"></select>
            </form>
            <br>
            <form>
                <label for="dateF">Choix de la date de fin : </label>
                <select id="dateF"></select>
            </form>

            <!-- Le template qui sert à formatter la liste des clients résultats -->
            <script id="dateDTemplate" type="text/template">
            {{! Pour chaque état dans le tableau}}
            {{#records}}
                {{! Une option dans le select }}
                {{! le point représente la valeur courante du tableau }}
                <OPTION VALUE="{{.}}">{{.}}</OPTION>
            {{/records}}
        </script>
        <script id="dateFTemplate" type="text/template">
            {{! Pour chaque état dans le tableau}}
            {{#records}}
                {{! Une option dans le select }}
                {{! le point représente la valeur courante du tableau }}
                <OPTION VALUE="{{.}}">{{.}}</OPTION>
            {{/records}}
        </script>
   
    </body>
</html>
